---
title: "Attach"
description: "Attach products and subscriptions to customers"
api: "POST https://api.useautumn.com/v1/attach"
---

## Overview

The `/attach` endpoint handles all purchase flows including:
- New subscriptions
- Product upgrades and downgrades
- Adding multiple products
- Free trial activation
- Checkout session creation

When a customer needs to make a payment, the response includes a `checkout_url` that redirects to a payment page. For immediate activations (like free plans or customers with existing payment methods), the product is attached directly without checkout.

## Authentication

<ParamField header="Authorization" type="string" required>
  Bearer token with your Autumn API key. Use your public key for client-side requests and secret key for server-side requests.
</ParamField>

## Request Body

<ParamField body="customer_id" type="string" required>
  ID which you provided when creating the customer. This uniquely identifies the customer in your system.
</ParamField>

<ParamField body="product_id" type="string">
  ID of a single product to attach. Required if `product_ids` is not provided. Use this for attaching one product at a time.
</ParamField>

<ParamField body="product_ids" type="string[]">
  Array of product IDs to attach multiple products at once. Required if `product_id` is not provided. Cannot be used together with `product_id`.
</ParamField>

<ParamField body="entity_id" type="string">
  The entity ID for entity-scoped products (e.g., team or workspace). Use this when attaching products to specific entities within a customer's account.
</ParamField>

<ParamField body="customer_data" type="object">
  Customer details to set when creating or updating a customer. Will also update the customer if name or email is not already set.

  <Expandable title="customer_data properties">
    <ParamField body="customer_data.name" type="string">
      Customer's full name
    </ParamField>
    <ParamField body="customer_data.email" type="string">
      Customer's email address (must be valid email format)
    </ParamField>
    <ParamField body="customer_data.metadata" type="object">
      Additional custom metadata to store with the customer
    </ParamField>
    <ParamField body="customer_data.stripe_id" type="string">
      Existing Stripe customer ID if you're migrating from Stripe
    </ParamField>
  </Expandable>
</ParamField>

<ParamField body="entity_data" type="object">
  Entity details when creating a new entity.

  <Expandable title="entity_data properties">
    <ParamField body="entity_data.feature_id" type="string" required>
      The feature ID that this entity is associated with
    </ParamField>
    <ParamField body="entity_data.name" type="string">
      Name of the entity (e.g., team name or workspace name)
    </ParamField>
  </Expandable>
</ParamField>

<ParamField body="options" type="array">
  Feature-level options for customizing quantities and settings per feature.

  <Expandable title="options properties">
    <ParamField body="options[].feature_id" type="string" required>
      The feature ID to configure
    </ParamField>
    <ParamField body="options[].quantity" type="number" required>
      The quantity/amount to set for this feature
    </ParamField>
  </Expandable>
</ParamField>

<ParamField body="success_url" type="string">
  URL to redirect to after successful payment. The customer will be redirected here when they complete the checkout process.
</ParamField>

<ParamField body="force_checkout" type="boolean" default={false}>
  Force creation of a checkout session even if the customer has a payment method on file. Useful when you want the user to explicitly confirm the purchase.
</ParamField>

<ParamField body="free_trial" type="boolean | object">
  Enable free trial for this product. Can be `true` to use default trial settings, or an object to customize the trial.

  <Expandable title="free_trial object properties">
    <ParamField body="free_trial.duration" type="number">
      Trial duration in days
    </ParamField>
    <ParamField body="free_trial.require_payment_method" type="boolean">
      Whether to require a payment method during trial signup
    </ParamField>
  </Expandable>
</ParamField>

<ParamField body="invoice" type="boolean" default={false}>
  Whether to generate an invoice for this attachment
</ParamField>

<ParamField body="metadata" type="object">
  Additional metadata to store with the product attachment
</ParamField>

<ParamField body="billing_cycle_anchor" type="number">
  Unix timestamp to align billing cycles. Use this to synchronize multiple subscriptions or set a specific billing date.
</ParamField>

<ParamField body="enable_product_immediately" type="boolean" default={false}>
  Enable the product immediately without waiting for payment confirmation. Use with caution.
</ParamField>

## Response

<ResponseField name="success" type="boolean" required>
  Whether the operation was successful
</ResponseField>

<ResponseField name="customer_id" type="string" required>
  The ID of the customer
</ResponseField>

<ResponseField name="product_ids" type="string[]" required>
  Array of product IDs that were attached
</ResponseField>

<ResponseField name="code" type="string" required>
  Response code indicating the operation result (e.g., "attached", "checkout_required")
</ResponseField>

<ResponseField name="message" type="string" required>
  Human-readable message describing the result
</ResponseField>

<ResponseField name="checkout_url" type="string | null">
  Stripe checkout URL if payment is required. Redirect the customer to this URL to complete the purchase. Will be `null` if no payment is required.
</ResponseField>

<ResponseField name="invoice" type="object | null">
  Invoice object if `invoice: true` was passed in the request. Contains the generated invoice details.
</ResponseField>

## Examples

### Immediate attachment (free plan)

<CodeGroup>

```bash curl
curl -X POST https://api.useautumn.com/v1/attach \
  -H "Authorization: Bearer am_sk_..." \
  -H "Content-Type: application/json" \
  -d '{
    "customer_id": "user_123",
    "product_id": "free_plan"
  }'
```

```javascript JavaScript
const response = await fetch('https://api.useautumn.com/v1/attach', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer am_sk_...',
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    customer_id: 'user_123',
    product_id: 'free_plan',
  }),
});

const data = await response.json();
console.log(data);
// {
//   "success": true,
//   "customer_id": "user_123",
//   "product_ids": ["free_plan"],
//   "code": "attached",
//   "message": "Product attached successfully",
//   "checkout_url": null,
//   "invoice": null
// }
```

```python Python
import requests

response = requests.post(
    'https://api.useautumn.com/v1/attach',
    headers={
        'Authorization': 'Bearer am_sk_...',
        'Content-Type': 'application/json',
    },
    json={
        'customer_id': 'user_123',
        'product_id': 'free_plan',
    }
)

data = response.json()
print(data)
```

</CodeGroup>

### Checkout flow (paid plan)

<CodeGroup>

```bash curl
curl -X POST https://api.useautumn.com/v1/attach \
  -H "Authorization: Bearer am_sk_..." \
  -H "Content-Type: application/json" \
  -d '{
    "customer_id": "user_123",
    "product_id": "pro_plan",
    "success_url": "https://yourapp.com/success",
    "customer_data": {
      "name": "John Doe",
      "email": "john@example.com"
    }
  }'
```

```javascript JavaScript
const response = await fetch('https://api.useautumn.com/v1/attach', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer am_sk_...',
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    customer_id: 'user_123',
    product_id: 'pro_plan',
    success_url: 'https://yourapp.com/success',
    customer_data: {
      name: 'John Doe',
      email: 'john@example.com',
    },
  }),
});

const data = await response.json();
console.log(data.checkout_url); // Redirect user to this URL
// {
//   "success": true,
//   "customer_id": "user_123",
//   "product_ids": ["pro_plan"],
//   "code": "checkout_required",
//   "message": "Checkout session created",
//   "checkout_url": "https://checkout.stripe.com/c/pay/...",
//   "invoice": null
// }
```

```python Python
import requests

response = requests.post(
    'https://api.useautumn.com/v1/attach',
    headers={
        'Authorization': 'Bearer am_sk_...',
        'Content-Type': 'application/json',
    },
    json={
        'customer_id': 'user_123',
        'product_id': 'pro_plan',
        'success_url': 'https://yourapp.com/success',
        'customer_data': {
            'name': 'John Doe',
            'email': 'john@example.com',
        },
    }
)

data = response.json()
# Redirect user to data['checkout_url']
```

</CodeGroup>

### Attach with feature options

Customize specific features when attaching a product:

<CodeGroup>

```bash curl
curl -X POST https://api.useautumn.com/v1/attach \
  -H "Authorization: Bearer am_sk_..." \
  -H "Content-Type: application/json" \
  -d '{
    "customer_id": "user_123",
    "product_id": "team_plan",
    "options": [
      {
        "feature_id": "seats",
        "quantity": 10
      },
      {
        "feature_id": "storage_gb",
        "quantity": 100
      }
    ]
  }'
```

```javascript JavaScript
const response = await fetch('https://api.useautumn.com/v1/attach', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer am_sk_...',
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    customer_id: 'user_123',
    product_id: 'team_plan',
    options: [
      { feature_id: 'seats', quantity: 10 },
      { feature_id: 'storage_gb', quantity: 100 },
    ],
  }),
});

const data = await response.json();
```

```python Python
import requests

response = requests.post(
    'https://api.useautumn.com/v1/attach',
    headers={
        'Authorization': 'Bearer am_sk_...',
        'Content-Type': 'application/json',
    },
    json={
        'customer_id': 'user_123',
        'product_id': 'team_plan',
        'options': [
            {'feature_id': 'seats', 'quantity': 10},
            {'feature_id': 'storage_gb', 'quantity': 100},
        ],
    }
)

data = response.json()
```

</CodeGroup>

## Use Cases

### Upgrading a customer

When a customer upgrades from a free plan to a paid plan:

```javascript
const response = await autumn.attach({
  customer_id: 'user_123',
  product_id: 'pro_plan',
  success_url: 'https://yourapp.com/success',
});

// If checkout_url exists, redirect the user
if (response.checkout_url) {
  window.location.href = response.checkout_url;
}
```

### Multiple products at once

Attach several products in a single request:

```javascript
const response = await autumn.attach({
  customer_id: 'user_123',
  product_ids: ['base_plan', 'addon_analytics', 'addon_support'],
});
```

### Entity-scoped products

Attach products to specific teams or workspaces:

```javascript
const response = await autumn.attach({
  customer_id: 'org_456',
  product_id: 'team_plan',
  entity_id: 'team_789',
  entity_data: {
    feature_id: 'teams',
    name: 'Engineering Team',
  },
});
```

## Error Handling

<ResponseField name="error" type="object">
  Error object returned when the request fails

  <Expandable title="error properties">
    <ResponseField name="error.code" type="string">
      Error code (e.g., "invalid_product", "customer_not_found", "payment_required")
    </ResponseField>
    <ResponseField name="error.message" type="string">
      Human-readable error message
    </ResponseField>
  </Expandable>
</ResponseField>

Common error codes:
- `invalid_product`: Product ID doesn't exist
- `customer_not_found`: Customer doesn't exist
- `payment_required`: Payment method required but not provided
- `already_attached`: Customer already has this product
- `validation_error`: Invalid request parameters

## Related Endpoints

- [Check](/api/check) - Verify customer access to features
- [Cancel](/api/cancel) - Cancel product attachments
- [Track](/api/track) - Record usage events
