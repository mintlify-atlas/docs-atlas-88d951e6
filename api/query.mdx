---
title: 'Query Usage'
description: 'Query customer usage analytics for metered features'
---

## POST /query

Query usage analytics for a customer's metered features. Returns time-series data showing usage over a specified time range. Useful for displaying usage graphs, tracking consumption, and analyzing customer behavior.

### Request Body

<ParamField body="customer_id" type="string" required>
  The ID of the customer to query analytics for.
  
  Example: `"cus_123"`
</ParamField>

<ParamField body="feature_id" type="string | string[]" required>
  The feature ID(s) to query. Can be a single feature ID string or an array of feature IDs to query multiple features at once.
  
  Example: `"api_calls"` or `["api_calls", "storage"]`
</ParamField>

<ParamField body="range" type="enum">
  Time range for the query. If not provided, defaults to `"last_cycle"`.
  
  **Options:**
  - `"24h"` - Last 24 hours
  - `"7d"` - Last 7 days
  - `"30d"` - Last 30 days
  - `"90d"` - Last 90 days
  - `"last_cycle"` - Current billing cycle
  
  Example: `"7d"`
</ParamField>

### Response

<ResponseField name="list" type="array">
  List of usage data points. Each data point contains a timestamp and usage count.
  
  Example:
  ```json
  [
    { "period": 1717000000000, "count": 100 },
    { "period": 1717086400000, "count": 150 }
  ]
  ```
  
  <Expandable title="DataPoint">
    <ResponseField name="period" type="number">
      Unix timestamp (in milliseconds) for this data point
    </ResponseField>
    
    <ResponseField name="count" type="number">
      Usage count for this period
    </ResponseField>
  </Expandable>
</ResponseField>

## Examples

<CodeGroup>
```bash Single Feature - 7 Days
curl -X POST https://api.autumn.com/query \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "customer_id": "cus_123",
    "feature_id": "api_calls",
    "range": "7d"
  }'
```

```bash Multiple Features - Current Cycle
curl -X POST https://api.autumn.com/query \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "customer_id": "cus_123",
    "feature_id": ["api_calls", "storage"],
    "range": "last_cycle"
  }'
```

```javascript JavaScript
const response = await fetch('https://api.autumn.com/query', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer YOUR_API_KEY',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    customer_id: 'cus_123',
    feature_id: 'api_calls',
    range: '7d'
  })
});

const data = await response.json();
console.log(data.list); // Array of usage data points
```

```python Python
import requests

response = requests.post(
  'https://api.autumn.com/query',
  headers={
    'Authorization': 'Bearer YOUR_API_KEY',
    'Content-Type': 'application/json'
  },
  json={
    'customer_id': 'cus_123',
    'feature_id': 'api_calls',
    'range': '30d'
  }
)

data = response.json()
for point in data['list']:
    print(f"Period: {point['period']}, Count: {point['count']}")
```

```typescript TypeScript
interface QueryRequest {
  customer_id: string;
  feature_id: string | string[];
  range?: '24h' | '7d' | '30d' | '90d' | 'last_cycle';
}

interface DataPoint {
  period: number;
  count: number;
}

interface QueryResponse {
  list: DataPoint[];
}

const queryUsage = async (params: QueryRequest): Promise<QueryResponse> => {
  const response = await fetch('https://api.autumn.com/query', {
    method: 'POST',
    headers: {
      'Authorization': 'Bearer YOUR_API_KEY',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(params)
  });
  
  return await response.json();
};

// Query single feature
const result = await queryUsage({
  customer_id: 'cus_123',
  feature_id: 'api_calls',
  range: '7d'
});

// Query multiple features
const multiResult = await queryUsage({
  customer_id: 'cus_123',
  feature_id: ['api_calls', 'storage'],
  range: 'last_cycle'
});
```
</CodeGroup>

### Example Response - Single Feature

```json
{
  "list": [
    { "period": 1717000000000, "count": 100 },
    { "period": 1717086400000, "count": 150 },
    { "period": 1717172800000, "count": 200 },
    { "period": 1717259200000, "count": 175 },
    { "period": 1717345600000, "count": 225 },
    { "period": 1717432000000, "count": 190 },
    { "period": 1717518400000, "count": 210 }
  ]
}
```

### Example Response - Multiple Features

When querying multiple features, the response structure depends on your API implementation. Typically, you'll receive separate data points or aggregated results.

## Use Cases

### Display usage graphs

Show customers their usage over time in a visual chart:

```javascript
const usageData = await queryUsage({
  customer_id: 'cus_123',
  feature_id: 'api_calls',
  range: '30d'
});

// Use with Chart.js, Recharts, or other charting library
const chartData = usageData.list.map(point => ({
  date: new Date(point.period),
  usage: point.count
}));
```

### Track usage against limits

Compare current usage against plan limits:

```javascript
const currentCycle = await queryUsage({
  customer_id: 'cus_123',
  feature_id: 'api_calls',
  range: 'last_cycle'
});

const totalUsage = currentCycle.list.reduce(
  (sum, point) => sum + point.count,
  0
);

const planLimit = 10000;
const percentageUsed = (totalUsage / planLimit) * 100;
```

### Analyze usage patterns

Identify usage trends to inform product decisions:

```python
import pandas as pd
from datetime import datetime

# Query 90 days of usage
response = query_usage(
    customer_id='cus_123',
    feature_id='api_calls',
    range='90d'
)

# Convert to pandas DataFrame
df = pd.DataFrame(response['list'])
df['date'] = pd.to_datetime(df['period'], unit='ms')

# Calculate daily average
avg_daily_usage = df['count'].mean()
print(f"Average daily usage: {avg_daily_usage}")
```

## Time Range Details

| Range | Description | Typical Data Points | Use Case |
|-------|-------------|---------------------|----------|
| `24h` | Last 24 hours | ~24 (hourly) | Real-time monitoring |
| `7d` | Last 7 days | ~7 (daily) | Weekly trends |
| `30d` | Last 30 days | ~30 (daily) | Monthly analysis |
| `90d` | Last 90 days | ~90 (daily) | Quarterly trends |
| `last_cycle` | Current billing cycle | Varies by cycle | Billing period usage |